# Action Plan: Movie Card Icon State Implementation

## 0. Guiding Principles & Execution Protocol

1. **Immutable Plan**: The agent must follow this plan exactly as written and MUST NOT edit it. If a step is impossible, it must stop and report the issue.
2. **Documentation is Law**: If the plan involves a library, the primary resource MUST be its official documentation. The agent must use the exact component names and props from the documentation.
3. **One Step at a Time**: The agent will perform only one "Action" at a time and will only proceed after successfully completing the "Verification" step for that action.
4. **Design System First**: When implementing UI changes, always establish design tokens and component styles before modifying existing components.
5. **Visual Verification**: For UI implementations, include visual verification steps (screenshots, design comparison) alongside functional verification.
6. **Frontend-Specific Steps**: Design system implementation steps (Parts 2-3) only apply to frontend/UI features. Backend features should skip these sections.
7. **Reference Existing Styles**: Before implementing new UI changes, always check existing style documentation in `.docs/knowledge/` and current component styles in `src/components/ui/` and `src/styles/` to avoid duplicating work and maintain consistency.

---

## 1. Overall Goal
Implement a state-based icon system for movie card sidepanel icons where:
- Icons display their natural cyan color by default (no CSS filters)
- Icons switch to filled versions when clicked (except "More Info" which stays unchanged)
- Clicked state persists across browser sessions via localStorage
- No focus rings or animations that create visual artifacts

**Explicitly NOT in scope:**
- This plan does not include creating the actual filled icon files (assumes they exist at `/icons/posters/*-filled.png`)
- This plan does not include modifying the movie data structure or API calls
- This plan does not include implementing new movie actions beyond the existing 5

## 2. Regression Risks & Mitigation

**Risks:**
- **Existing functionality breakage**: Current MovieCard hover interactions and button functionality could be disrupted
- **Design system inconsistency**: New icon paths might conflict with existing design patterns
- **Performance degradation**: localStorage operations might cause performance issues with many movies
- **Visual artifacts**: Focus rings or animations might still appear

**Mitigation:**
- Test each component individually after changes
- Maintain existing localStorage key format for backward compatibility
- Remove all CSS filters and focus styles to prevent visual artifacts
- Use existing design system patterns for consistency

## 3. Structured Action & Verification Plan

### Part 1: Interface and Data Structure Updates

- **Action 1.1:** Update the `MovieCardAction` interface in `src/app/_components/client/movie-card-icons.ts` to include a `filledIconPath` property
- **Verification 1.1:** Check that the interface compiles without TypeScript errors and the new property is properly typed

- **Action 1.2:** Update the `MOVIE_CARD_ACTIONS` array to include filled icon paths for all actions (except "More Info" which uses the same icon)
- **Verification 1.2:** Verify that all actions have both `iconPath` and `filledIconPath` properties, and "More Info" uses the same path for both

- **Action 1.3:** Remove the `filter` property from `ICON_CONFIG` in the same file
- **Verification 1.3:** Confirm that `ICON_CONFIG` no longer contains any color transformation properties

### Part 2: Component Logic Implementation

- **Action 2.1:** Replace the entire `MovieCardIcon` component in `src/app/_components/client/MovieCardIcon.tsx` with new logic that uses `getIconPath()` function
- **Verification 2.1:** Component compiles without errors and imports the correct dependencies (`cn` from `~/lib/utils`, `MOVIE_CARD_ACTIONS` from `./movie-card-icons`)

- **Action 2.2:** Implement the `getIconPath()` function that returns the appropriate icon based on clicked state and action type
- **Verification 2.2:** Function correctly returns default icon for "More Info" and filled icon for clicked state of other actions

- **Action 2.3:** Remove all animation variant imports and usage from the component
- **Verification 2.3:** Component no longer imports or uses `animationVariants.iconActive` or `animationVariants.iconInactive`

### Part 3: Style System Updates

- **Action 3.1:** Remove the focus ring styles from `iconButton` in `src/styles/component-styles.ts` (line ~323)
- **Verification 3.1:** The `iconButton` variant no longer contains `focus:ring-2` or `focus:border` properties

- **Action 3.2:** Remove the white filter from `iconImage` in `src/styles/component-styles.ts` (line ~331)
- **Verification 3.2:** The `iconImage` variant no longer contains `filter brightness-0 invert` property

- **Action 3.3:** Add `focus:outline-none` to the button className in the MovieCardIcon component
- **Verification 3.3:** Button element includes the focus override class to prevent any focus ring artifacts

### Part 4: Integration and Testing

- **Action 4.1:** Test the icon state changes by clicking on different icons and verifying they switch to filled versions
- **Verification 4.1:** Icons display cyan by default, switch to filled versions when clicked, and "More Info" stays unchanged

- **Action 4.2:** Test localStorage persistence by refreshing the page and verifying clicked state is maintained
- **Verification 4.2:** Icons that were clicked before refresh remain in their filled state after page reload

- **Action 4.3:** Verify no visual artifacts (white squares, focus rings) appear when clicking icons
- **Verification 4.3:** Clicking icons produces no unwanted visual effects beyond the intended state change

---

## 4. Expected Outcome

After completing all actions, the movie card sidepanel icons will:
- Display their natural cyan color by default (no white filters)
- Switch to filled versions when clicked (except "More Info")
- Persist clicked state across browser sessions
- Have no focus rings or visual artifacts
- Maintain all existing functionality (tooltips, click handlers, etc.)

The implementation will be clean, performant, and consistent with the existing design system. 
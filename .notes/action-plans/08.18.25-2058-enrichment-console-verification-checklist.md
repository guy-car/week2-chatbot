# Action Plan: Enrichment Console Verification Checklist (external_ids → OMDb → watch/providers)

## 0. Guiding Principles & Execution Protocol (NEW)
1. Immutable plan; if blocked, stop and report.
2. Docs-first: TMDB + OMDb official docs; align with `.docs/knowledge/*`.
3. One step at a time; console verification for each step.

Cross-references:
- Phase A (No Cache): `08.18.25-2133-modal-enrichment-phase-a-no-cache.md`
- Phase B (Caching with Redis): `08.18.25-2110-modal-enrichment-lean-plan.md`

## 1. Overall Goal
Quickly validate each external call independently via server-side console logs before wiring into tRPC/UI.

## 2. Checklist

### Step 1 — TMDB external_ids (movie/tv)
- **Action**: Implement `fetchExternalIds(type, id)` with dual-read token helper (`TMDB_BEARER_TOKEN` or `TMDB_API_KEY`), 1500ms timeout.
- **Verification**: Console.log raw payload and extracted `imdb_id` for 1 movie and 1 tv id; log duration and which token var name was used.

### Step 2 — OMDb ratings (requires imdb_id)
- **Action**: Implement `fetchOmdbRatings(imdbId)` using `?i={imdbId}&apikey={OMDB_API_KEY}`; parse RT, Metacritic, IMDb.
- **Verification**: Console.log raw response and parsed strings (e.g., RT “87%”, Metacritic “74/100”, IMDb “7.8/10”); handle missing ratings.

### Step 3 — TMDB watch/providers (US only, stream-first)
- **Action**: Implement `fetchWatchProviders(type, id)`; extract `results.US`, filter `flatrate` to whitelist [Netflix, Prime Video, Max, Disney+, Hulu, Apple TV+, Peacock, Paramount+, Tubi, Freevee], cap 5; build logo URLs `w92` and include landing `link`.
- **Verification**: Console.log raw `results.US` and final filtered list; verify whitelist order and cap.

## 3. Notes
- Use partials on timeouts; never block later steps.
- These console checks are educational and pave the way for the tRPC enrich query and the modal UI work.
